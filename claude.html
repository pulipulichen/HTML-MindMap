<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‚ç›´å¿ƒæ™ºåœ–ç¹ªè£½å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'Noto Sans TC', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .content {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 0;
            min-height: 700px;
        }

        .input-panel {
            background: #f8f9fa;
            padding: 30px;
            border-right: 2px solid #e0e0e0;
        }

        .input-panel h2 {
            margin-bottom: 15px;
            color: #333;
            font-size: 20px;
        }

        .input-panel textarea {
            width: 100%;
            height: 350px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            transition: border-color 0.3s;
        }

        .input-panel textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .controls {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .preview-panel {
            padding: 40px;
            overflow: auto;
            background: #1a1a1a;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        #mindmap-container {
            position: relative;
            display: inline-block;
            min-width: 800px;
        }

        .mindmap {
            position: relative;
            padding: 40px;
        }

        .root-node {
            background: white;
            border: 4px solid #333;
            border-radius: 20px;
            padding: 25px 40px;
            font-size: 32px;
            font-weight: bold;
            text-align: center;
            white-space: pre-line;
            margin: 0 auto 60px;
            width: fit-content;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            position: relative;
            z-index: 10;
        }

        .branches {
            display: flex;
            justify-content: center;
            gap: 60px;
            position: relative;
        }

        .branch {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .branch-node {
            background: white;
            border: 4px solid;
            border-radius: 15px;
            padding: 20px 35px;
            font-size: 22px;
            font-weight: bold;
            text-align: center;
            white-space: pre-line;
            margin-bottom: 30px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            position: relative;
            z-index: 10;
        }

        .branch.red .branch-node {
            border-color: #ff6b6b;
        }

        .branch.orange .branch-node {
            border-color: #ffa500;
        }

        .branch.green .branch-node {
            border-color: #4ecdc4;
        }

        .sub-items {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0;
        }

        .sub-item {
            color: #999;
            font-size: 17px;
            padding: 25px 20px;
            text-align: center;
            white-space: pre-line;
            position: relative;
            z-index: 10;
        }

        svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .example {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 13px;
            line-height: 1.8;
            color: #495057;
        }

        .example h3 {
            margin-bottom: 10px;
            color: #333;
            font-size: 14px;
        }

        @media (max-width: 1200px) {
            .content {
                grid-template-columns: 1fr;
            }

            .input-panel {
                border-right: none;
                border-bottom: 2px solid #e0e0e0;
            }

            #mindmap-container {
                min-width: auto;
            }

            .branches {
                gap: 40px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ å‚ç›´å¿ƒæ™ºåœ–ç¹ªè£½å·¥å…·</h1>
            <p>è¼¸å…¥æ–‡å­—å…§å®¹ï¼Œè‡ªå‹•ç”Ÿæˆç²¾ç¾çš„å‚ç›´å¿ƒæ™ºåœ–</p>
        </div>

        <div class="content">
            <div class="input-panel">
                <h2>ğŸ“ è¼¸å…¥å…§å®¹</h2>
                <textarea id="input-text" placeholder="è«‹è¼¸å…¥æ‚¨çš„å¿ƒæ™ºåœ–å…§å®¹...">è¨ªè«‡åˆ†æ
- å¯¦ä½œï¼š\nè¨ªè«‡è½‰éŒ„
  - è¨ªè«‡æº–å‚™
  - é–‹å•Ÿè½‰éŒ„
  - å®Œæˆè½‰éŒ„
- è³‡æ–™åˆ†æ\nèˆ‡RAG
  - èªéŸ³è½‰éŒ„çš„é™åˆ¶
  - æª¢ç´¢å¢å¼·ç”ŸæˆRAG
  - Google\nNotebookLM
- å¯¦ä½œï¼š\nç”¨RAGåˆ†æè¨ªè«‡
  - å»ºç«‹ç­†è¨˜æœ¬
  - è¨ªè«‡åˆ†ææç¤ºè©
  - è§€å¯Ÿåˆ†æçµæœ</textarea>

                <div class="controls">
                    <button class="btn btn-primary" onclick="generateMindmap()">ğŸ¨ ç”Ÿæˆå¿ƒæ™ºåœ–</button>
                    <button class="btn btn-secondary" onclick="clearInput()">ğŸ—‘ï¸ æ¸…é™¤</button>
                    <button class="btn btn-success" onclick="downloadImage()">ğŸ’¾ ä¸‹è¼‰åœ–ç‰‡</button>
                </div>

                <div class="example">
                    <h3>ğŸ“‹ æ ¼å¼èªªæ˜ï¼š</h3>
                    <pre>æ ¹ç¯€é»
- ç¬¬ä¸€å±¤ç¯€é»\nï¼ˆå¯æ›è¡Œï¼‰
  - ç¬¬äºŒå±¤å­é …ç›®1
  - ç¬¬äºŒå±¤å­é …ç›®2
- ç¬¬äºŒå€‹ç¬¬ä¸€å±¤ç¯€é»
  - å­é …ç›®</pre>
                </div>
            </div>

            <div class="preview-panel">
                <div id="mindmap-container"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        function parseMindmap(text) {
            const lines = text.trim().split('\n');
            const root = {
                text: lines[0].trim(),
                children: []
            };

            let currentParent = null;

            for (let i = 1; i < lines.length; i++) {
                const line = lines[i];
                const indent = line.search(/\S/);
                const text = line.trim().replace(/^-\s*/, '');

                if (indent === 0 && line.startsWith('-')) {
                    currentParent = {
                        text: text,
                        children: []
                    };
                    root.children.push(currentParent);
                } else if (indent >= 2 && currentParent) {
                    currentParent.children.push(text);
                }
            }

            return root;
        }

        function createMindmapHTML(data) {
            const colors = ['red', 'orange', 'green'];
            
            let html = '<div class="mindmap" id="mindmap-content">';
            html += '<svg id="connection-lines"></svg>';
            
            // Root node
            html += `<div class="root-node" id="root-node">${data.text}</div>`;
            
            // Branches
            html += '<div class="branches">';
            data.children.forEach((child, index) => {
                const color = colors[index % colors.length];
                html += `<div class="branch ${color}">`;
                html += `<div class="branch-node" data-index="${index}">${child.text}</div>`;
                
                if (child.children.length > 0) {
                    html += '<div class="sub-items">';
                    child.children.forEach(subItem => {
                        html += `<div class="sub-item">${subItem}</div>`;
                    });
                    html += '</div>';
                }
                
                html += '</div>';
            });
            html += '</div>';
            
            html += '</div>';
            return html;
        }

        function drawConnections() {
            setTimeout(() => {
                const svg = document.getElementById('connection-lines');
                const mindmapContent = document.getElementById('mindmap-content');
                if (!svg || !mindmapContent) return;

                const containerRect = mindmapContent.getBoundingClientRect();
                svg.setAttribute('width', containerRect.width);
                svg.setAttribute('height', containerRect.height);
                svg.innerHTML = '';

                const rootNode = document.getElementById('root-node');
                if (!rootNode) return;

                const rootRect = rootNode.getBoundingClientRect();
                const rootCenterX = rootRect.left + rootRect.width / 2 - containerRect.left;
                const rootBottom = rootRect.bottom - containerRect.top;

                const branchNodes = document.querySelectorAll('.branch-node');
                const colors = ['#ff6b6b', '#ffa500', '#4ecdc4'];

                branchNodes.forEach((branchNode, index) => {
                    const branchRect = branchNode.getBoundingClientRect();
                    const branchCenterX = branchRect.left + branchRect.width / 2 - containerRect.left;
                    const branchTop = branchRect.top - containerRect.top;
                    const branchBottom = branchRect.bottom - containerRect.top;

                    const color = colors[index % colors.length];
                    
                    // Curved line from root to branch
                    const controlY = rootBottom + (branchTop - rootBottom) / 2;
                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    const d = `M ${rootCenterX} ${rootBottom} 
                               C ${rootCenterX} ${controlY}, 
                                 ${branchCenterX} ${controlY}, 
                                 ${branchCenterX} ${branchTop}`;
                    
                    path.setAttribute('d', d);
                    path.setAttribute('stroke', color);
                    path.setAttribute('stroke-width', '4');
                    path.setAttribute('fill', 'none');
                    path.setAttribute('stroke-linecap', 'round');
                    svg.appendChild(path);

                    // Straight lines connecting sub-items
                    const branch = branchNode.closest('.branch');
                    const subItems = branch.querySelectorAll('.sub-item');
                    
                    if (subItems.length > 0) {
                        subItems.forEach((subItem, subIndex) => {
                            const subRect = subItem.getBoundingClientRect();
                            const subCenterY = subRect.top + subRect.height / 2 - containerRect.top;
                            
                            let startY;
                            if (subIndex === 0) {
                                // First sub-item connects to branch node
                                startY = branchBottom;
                            } else {
                                // Subsequent sub-items connect to previous sub-item
                                const prevSubItem = subItems[subIndex - 1];
                                const prevRect = prevSubItem.getBoundingClientRect();
                                startY = prevRect.top + prevRect.height / 2 - containerRect.top;
                            }
                            
                            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                            line.setAttribute('x1', branchCenterX);
                            line.setAttribute('y1', startY);
                            line.setAttribute('x2', branchCenterX);
                            line.setAttribute('y2', subCenterY);
                            line.setAttribute('stroke', color);
                            line.setAttribute('stroke-width', '3');
                            line.setAttribute('stroke-linecap', 'round');
                            svg.appendChild(line);
                        });
                    }
                });
            }, 100);
        }

        function generateMindmap() {
            const input = document.getElementById('input-text').value;
            const container = document.getElementById('mindmap-container');
            
            if (!input.trim()) {
                alert('è«‹è¼¸å…¥å¿ƒæ™ºåœ–å…§å®¹ï¼');
                return;
            }

            try {
                const data = parseMindmap(input);
                const html = createMindmapHTML(data);
                container.innerHTML = html;
                drawConnections();
            } catch (error) {
                alert('è§£æéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥æ ¼å¼ï¼');
                console.error(error);
            }
        }

        function clearInput() {
            document.getElementById('input-text').value = '';
            document.getElementById('mindmap-container').innerHTML = '';
        }

        function downloadImage() {
            const element = document.getElementById('mindmap-content');
            if (!element) {
                alert('è«‹å…ˆç”Ÿæˆå¿ƒæ™ºåœ–ï¼');
                return;
            }

            html2canvas(element, {
                backgroundColor: '#1a1a1a',
                scale: 2,
                logging: false,
                useCORS: true
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'mindmap-' + Date.now() + '.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }

        window.addEventListener('resize', drawConnections);

        // åˆå§‹åŒ–æ™‚è‡ªå‹•ç”Ÿæˆ
        window.addEventListener('load', () => {
            generateMindmap();
        });
    </script>
</body>
</html>